# ì‹œê°„í‘œ í˜ì´ì§€ - í•™ìƒë³„ ì‹œê°„í‘œ ê´€ë¦¬ í†µí•© êµ¬í˜„ ê³„íšì„œ

## ğŸ“‹ ê°œìš”

TimeTable.tsx í˜ì´ì§€ì— í•™ìƒ ëª©ë¡(ì™¼ìª½)ê³¼ ì„ íƒëœ í•™ìƒì˜ ê³ ê¸‰ 2ë ˆì´ì–´ ì‹œê°„í‘œ(ì˜¤ë¥¸ìª½)ë¥¼ í‘œì‹œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ í†µí•© ê³„íšì„œì…ë‹ˆë‹¤. DATABASE_DESIGN.mdì˜ ëª¨ë“  ìš”êµ¬ì‚¬í•­ê³¼ ì‚¬ìš©ìë³„ ë°ì´í„° ê²©ë¦¬ ì•„í‚¤í…ì²˜ë¥¼ ì™„ë²½íˆ ë°˜ì˜í•©ë‹ˆë‹¤.

### ëª©í‘œ
- **ì™¼ìª½ íŒ¨ë„**: í˜„ì¬ ì‚¬ìš©ìê°€ ê´€ë¦¬í•˜ëŠ” í•™ìƒ ëª©ë¡ í‘œì‹œ ë° ê´€ë¦¬
- **ì˜¤ë¥¸ìª½ íŒ¨ë„**: ì„ íƒëœ í•™ìƒì˜ ê³ ê¸‰ 2ë ˆì´ì–´ ì‹œê°„í‘œ í‘œì‹œ ë° í¸ì§‘
- **ê³ ê¸‰ ì‹œê°„í‘œ**: ë“±ì›/í•˜ì› + ì„¸ë¶€ì¼ì • ë¶„ë¦¬, ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸°, ë§í¬ ê³µìœ  ê¸°ëŠ¥
- **ì™„ì „í•œ ë°ì´í„° ê²©ë¦¬**: Google ì¸ì¦ ê¸°ë°˜ ì‚¬ìš©ìë³„ ë°ì´í„° ë¶„ë¦¬

## ğŸ—„ï¸ í†µí•© ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### 1. ì „ì²´ ì»¬ë ‰ì…˜ êµ¬ì¡° (DATABASE_DESIGN.md ê¸°ì¤€)

```
users/{userId} (Google ì¸ì¦ ê¸°ë°˜)
â”œâ”€â”€ (ì‚¬ìš©ì ê¸°ë³¸ ì •ë³´)
â”œâ”€â”€ students/                    // í•™ìƒ ì •ë³´ ê´€ë¦¬
â”œâ”€â”€ student_timetables/          // í•™ìƒë³„ ì‹œê°„í‘œ (ì‹ ê·œ ì¶”ê°€)
â”œâ”€â”€ timetables/                  // ê°œì¸/í…œí”Œë¦¿ ì‹œê°„í‘œ
â”œâ”€â”€ shared_schedules/            // ì‹œê°„í‘œ ê³µìœ  ë§í¬ ê´€ë¦¬
â”œâ”€â”€ schedule_contributions/      // ì™¸ë¶€ ì¼ì • ê¸°ì—¬ ìˆ˜ì§‘
â”œâ”€â”€ seats/                       // ì¢Œì„ ì •ë³´
â”œâ”€â”€ seat_assignments/            // ì¢Œì„ ë°°ì •
â”œâ”€â”€ seat_layouts/                // ì¢Œì„ ë°°ì¹˜ë„
â”œâ”€â”€ class_sections/              // í•™ê¸‰ ì •ë³´
â”œâ”€â”€ attendance_summaries/        // ì¶œì„ ìš”ì•½
â””â”€â”€ settings/                    // ì‚¬ìš©ì ì„¤ì •
```

### 2. í•™ìƒë³„ ì‹œê°„í‘œ ë°ì´í„° ëª¨ë¸ (í•µì‹¬)

```typescript
// users/{userId}/student_timetables/{timetableId}
interface StudentTimetable {
  id: string;                          // ë¬¸ì„œ ID
  studentId: string;                   // í•´ë‹¹ í•™ìƒ ID (students ì»¬ë ‰ì…˜ ì°¸ì¡°)
  studentName: string;                 // í•™ìƒ ì´ë¦„ (ìºì‹œìš©)

  // ì‹œê°„í‘œ ê¸°ë³¸ ì •ë³´
  name: string;                        // ì‹œê°„í‘œ ì´ë¦„ (ì˜ˆ: "1í•™ê¸° ì‹œê°„í‘œ")
  description?: string;                // ì‹œê°„í‘œ ì„¤ëª…

  // 1ì°¨ ë ˆì´ì–´: ë“±ì›/í•˜ì› ê¸°ë³¸ í‹€ (DATABASE_DESIGN.md ê¸°ì¤€)
  basicSchedule: {
    arrivalTime: string;               // ë“±ì› ì‹œê°„ "09:00"
    departureTime: string;             // í•˜ì› ì‹œê°„ "18:00"
    daysOfWeek: DayOfWeek[];          // í™œì„± ìš”ì¼ ["monday", "tuesday", ...]
    timeSlotInterval: number;          // ì‹œê°„ ë‹¨ìœ„ (ë¶„) ê¸°ë³¸ê°’: 30
  };

  // 2ì°¨ ë ˆì´ì–´: êµ¬ì²´ì ì¸ ì¼ì • (DATABASE_DESIGN.md ê¸°ì¤€)
  detailedSchedule: {
    [dayOfWeek: string]: {             // "monday", "tuesday" ë“±
      timeSlots: {
        startTime: string;             // "10:00"
        endTime: string;               // "11:30"
        subject: string;               // "ìˆ˜í•™", "ì˜ì–´", "ììŠµ"
        type: 'class' | 'self_study'; // ìˆ˜ì—…/ììŠµ êµ¬ë¶„
        isAutoGenerated: boolean;      // ìë™ìƒì„±ëœ ììŠµì‹œê°„ì¸ì§€
        color?: string;                // ì‹œê°„í‘œ í‘œì‹œ ìƒ‰ìƒ
        teacher?: string;              // ë‹´ë‹¹ ê°•ì‚¬
        location?: string;             // ìˆ˜ì—… ì¥ì†Œ
        notes?: string;                // ì¶”ê°€ ë©”ëª¨
      }[];
    };
  };

  // ê³µìœ  ê¸°ëŠ¥ (DATABASE_DESIGN.md ê¸°ì¤€)
  isShared: boolean;                   // ê³µìœ  í™œì„±í™” ì—¬ë¶€
  shareToken?: string;                 // ë§í¬ ê³µìœ ìš© ê³ ìœ  í† í°
  shareSettings: {
    allowEdit: boolean;                // ì™¸ë¶€ í¸ì§‘ í—ˆìš©
    allowView: boolean;                // ì™¸ë¶€ ì¡°íšŒ í—ˆìš©
    expiresAt?: FirestoreTimestamp;    // ê³µìœ  ë§Œë£Œì¼
  };

  // ìë™ ì±„ìš°ê¸° ì„¤ì • (DATABASE_DESIGN.md ê¸°ì¤€)
  autoFillSettings: {
    enabled: boolean;                  // ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸° í™œì„±í™”
    defaultSubject: string;            // ê¸°ë³¸ ììŠµ ê³¼ëª©ëª… "ììŠµ"
    fillEmptySlots: boolean;           // ë¹ˆ ì‹œê°„ ìë™ ì±„ìš°ê¸°
  };

  // ìƒíƒœ ê´€ë¦¬
  isActive: boolean;                   // í™œì„± ì‹œê°„í‘œ (í•™ìƒë‹¹ í•˜ë‚˜ë§Œ í™œì„±)
  isDefault: boolean;                  // ê¸°ë³¸ ì‹œê°„í‘œ ì—¬ë¶€

  // ë©”íƒ€ë°ì´í„°
  createdAt: FirestoreTimestamp;       // ìƒì„±ì¼
  updatedAt: FirestoreTimestamp;       // ìˆ˜ì •ì¼
  userId: string;                      // ì†Œìœ ì ì‚¬ìš©ì ID (Google Auth UID)
}

type DayOfWeek = 'monday' | 'tuesday' | 'wednesday' | 'thursday' | 'friday' | 'saturday' | 'sunday';
```

### 3. í•™ìƒ ì •ë³´ í™•ì¥ (ê¸°ì¡´ + ì‹œê°„í‘œ ì—°ë™)

```typescript
// users/{userId}/students/{studentId}
interface Student {
  id: string;                      // Firestore ë¬¸ì„œ ID
  name: string;                    // í•™ìƒ ì´ë¦„
  email: string;                   // í•™ìƒ ì´ë©”ì¼
  grade: string;                   // í•™ìƒ í•™ë…„ (ì¤‘1, ì¤‘2, ì¤‘3, ê³ 1, ê³ 2, ê³ 3)
  phone?: string;                  // í•™ìƒ ì „í™”ë²ˆí˜¸
  parentName?: string;             // ë³´í˜¸ì ì´ë¦„
  parentPhone?: string;            // ë³´í˜¸ì ì „í™”ë²ˆí˜¸
  address?: string;                // ì£¼ì†Œ

  // ì‹œê°„í‘œ ê´€ë ¨ ì •ë³´ (ì¶”ê°€)
  activeTimetableId?: string;      // í˜„ì¬ í™œì„± ì‹œê°„í‘œ ID
  timetableCount: number;          // ì´ ì‹œê°„í‘œ ê°œìˆ˜

  // ìƒíƒœ ê´€ë¦¬
  isActive: boolean;               // í™œì„± ìƒíƒœ
  createdAt: Date;                 // ìƒì„±ì¼
  updatedAt: Date;                 // ìˆ˜ì •ì¼
  userId: string;                  // ì†Œìœ ì ì‚¬ìš©ì ID (Google Auth UID)
}
```

### 4. Firestore ë³´ì•ˆ ê·œì¹™ ì—…ë°ì´íŠ¸

```javascript
// firestore.rulesì— ì¶”ê°€
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ì‚¬ìš©ìë³„ ë°ì´í„° - Google ì¸ì¦ ê¸°ë°˜ ê²©ë¦¬
    match /users/{userId} {
      // ì‚¬ìš©ìëŠ” ë³¸ì¸ ë°ì´í„°ë§Œ ì ‘ê·¼ ê°€ëŠ¥
      allow read, write: if request.auth != null &&
        request.auth.uid == userId;

      // í•™ìƒ ì •ë³´ - í•´ë‹¹ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥
      match /students/{studentId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == userId;
      }

      // í•™ìƒë³„ ì‹œê°„í‘œ - í•´ë‹¹ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥ (ì‹ ê·œ)
      match /student_timetables/{timetableId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == userId;
      }

      // ì‹œê°„í‘œ ê³µìœ  ë§í¬ ê´€ë¦¬ - ë³¸ì¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥
      match /shared_schedules/{scheduleId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == userId;
      }

      // ì™¸ë¶€ ì¼ì • ê¸°ì—¬ ìˆ˜ì§‘ - ë³¸ì¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥
      match /schedule_contributions/{contributionId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == userId;
      }

      // ê¸°íƒ€ ëª¨ë“  í•˜ìœ„ ì»¬ë ‰ì…˜
      match /{subCollection}/{docId} {
        allow read, write: if request.auth != null &&
          request.auth.uid == userId;
      }
    }

    // ë£¨íŠ¸ ë ˆë²¨ ì ‘ê·¼ ì°¨ë‹¨
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

## ğŸ”§ ë°±ì—”ë“œ êµ¬í˜„ (Cloud Functions)

### 1. í•™ìƒë³„ ì‹œê°„í‘œ ê´€ë¦¬ í•¨ìˆ˜

`functions/src/modules/personal/studentTimetableManagement.ts` ìƒì„±:

```typescript
/**
 * í•™ìƒë³„ ì‹œê°„í‘œ ê´€ë¦¬ Cloud Functions
 * DATABASE_DESIGN.mdì˜ ê³ ê¸‰ ì‹œê°„í‘œ êµ¬ì¡° ì™„ë²½ ì§€ì›
 */

import { onCall, HttpsError } from "firebase-functions/v2/https";
import { getFirestore, FieldValue } from "firebase-admin/firestore";

const db = getFirestore();

// í•™ìƒë³„ ì‹œê°„í‘œ CRUD
export const createStudentTimetable = onCall(async (request) => {
  // Google ì¸ì¦ í™•ì¸
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { studentId, name, basicSchedule, autoFillSettings } = request.data;

  // ìƒˆ ì‹œê°„í‘œ ìƒì„±
  const timetableData = {
    studentId,
    studentName: "", // í•™ìƒ ì •ë³´ì—ì„œ ê°€ì ¸ì˜¬ ì˜ˆì •
    name,
    basicSchedule,
    detailedSchedule: {},
    isShared: false,
    shareSettings: {
      allowEdit: false,
      allowView: false
    },
    autoFillSettings: {
      enabled: true,
      defaultSubject: "ììŠµ",
      fillEmptySlots: true,
      ...autoFillSettings
    },
    isActive: false,
    isDefault: false,
    createdAt: FieldValue.serverTimestamp(),
    updatedAt: FieldValue.serverTimestamp(),
    userId
  };

  // Firestoreì— ì €ì¥
  const docRef = await db.collection(`users/${userId}/student_timetables`).add(timetableData);

  return { id: docRef.id, ...timetableData };
});

export const getStudentTimetables = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { studentId } = request.data;

  const snapshot = await db
    .collection(`users/${userId}/student_timetables`)
    .where("studentId", "==", studentId)
    .orderBy("createdAt", "desc")
    .get();

  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
});

export const updateStudentTimetable = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { timetableId, updates } = request.data;

  const updateData = {
    ...updates,
    updatedAt: FieldValue.serverTimestamp()
  };

  await db.doc(`users/${userId}/student_timetables/${timetableId}`).update(updateData);

  return { success: true };
});

// ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸° (DATABASE_DESIGN.md ê¸°ì¤€)
export const autoFillStudentTimetable = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { timetableId } = request.data;

  // ì‹œê°„í‘œ ì¡°íšŒ
  const timetableDoc = await db.doc(`users/${userId}/student_timetables/${timetableId}`).get();
  if (!timetableDoc.exists) {
    throw new HttpsError("not-found", "ì‹œê°„í‘œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }

  const timetableData = timetableDoc.data();
  const { basicSchedule, detailedSchedule, autoFillSettings } = timetableData;

  // ìë™ ì±„ìš°ê¸° ë¡œì§ êµ¬í˜„
  const updatedSchedule = { ...detailedSchedule };

  for (const day of basicSchedule.daysOfWeek) {
    if (!updatedSchedule[day]) {
      updatedSchedule[day] = { timeSlots: [] };
    }

    // ë“±ì› ì‹œê°„ë¶€í„° í•˜ì› ì‹œê°„ê¹Œì§€ ì‹œê°„ ìŠ¬ë¡¯ ìƒì„±
    const startTime = parseTime(basicSchedule.arrivalTime);
    const endTime = parseTime(basicSchedule.departureTime);
    const interval = basicSchedule.timeSlotInterval;

    // ê¸°ì¡´ ì¼ì •ì´ ì—†ëŠ” ì‹œê°„ëŒ€ì— ììŠµ ì¶”ê°€
    // ... ìë™ ì±„ìš°ê¸° ë¡œì§ êµ¬í˜„
  }

  // ì—…ë°ì´íŠ¸ëœ ìŠ¤ì¼€ì¤„ ì €ì¥
  await db.doc(`users/${userId}/student_timetables/${timetableId}`).update({
    detailedSchedule: updatedSchedule,
    updatedAt: FieldValue.serverTimestamp()
  });

  return { success: true, detailedSchedule: updatedSchedule };
});

// ì‹œê°„í‘œ ê³µìœ  ê¸°ëŠ¥ (DATABASE_DESIGN.md ê¸°ì¤€)
export const createStudentTimetableShareLink = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { timetableId, shareSettings } = request.data;

  // ê³ ìœ  ê³µìœ  í† í° ìƒì„±
  const shareToken = generateUniqueToken();

  // ì‹œê°„í‘œì— ê³µìœ  ì •ë³´ ì—…ë°ì´íŠ¸
  await db.doc(`users/${userId}/student_timetables/${timetableId}`).update({
    isShared: true,
    shareToken,
    shareSettings: {
      allowEdit: shareSettings.allowEdit || false,
      allowView: shareSettings.allowView || true,
      expiresAt: shareSettings.expiresAt || null
    },
    updatedAt: FieldValue.serverTimestamp()
  });

  // shared_schedules ì»¬ë ‰ì…˜ì— ê³µìœ  ì •ë³´ ì €ì¥
  await db.collection(`users/${userId}/shared_schedules`).add({
    shareToken,
    timetableId,
    permissions: {
      canEdit: shareSettings.allowEdit || false,
      canView: shareSettings.allowView || true,
      canComment: false
    },
    accessSettings: {
      requireName: true,
      requireEmail: false
    },
    linkSettings: {
      isActive: true,
      expiresAt: shareSettings.expiresAt || null,
      createdAt: FieldValue.serverTimestamp(),
      usageCount: 0
    },
    createdAt: FieldValue.serverTimestamp(),
    updatedAt: FieldValue.serverTimestamp()
  });

  return { shareToken, shareUrl: `${process.env.BASE_URL}/shared/${shareToken}` };
});

// ì™¸ë¶€ ì¼ì • ê¸°ì—¬ ì²˜ë¦¬ (DATABASE_DESIGN.md ê¸°ì¤€)
export const contributeToStudentTimetable = onCall(async (request) => {
  const { shareToken, contributions, contributor } = request.data;

  // ê³µìœ  ë§í¬ ìœ íš¨ì„± í™•ì¸
  // ... êµ¬í˜„

  // schedule_contributions ì»¬ë ‰ì…˜ì— ê¸°ì—¬ ë°ì´í„° ì €ì¥
  // ... êµ¬í˜„

  return { success: true };
});

// ê¸°ì—¬ ë°ì´í„° ìŠ¹ì¸/ê±°ë¶€ ì²˜ë¦¬
export const processStudentTimetableContribution = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { contributionId, action } = request.data; // 'approve' | 'reject'

  // ê¸°ì—¬ ë°ì´í„° ì¡°íšŒ ë° ì²˜ë¦¬
  // ... êµ¬í˜„

  return { success: true };
});

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function generateUniqueToken(): string {
  return Math.random().toString(36).substring(2) + Date.now().toString(36);
}

function parseTime(timeString: string): number {
  const [hours, minutes] = timeString.split(':').map(Number);
  return hours * 60 + minutes;
}
```

### 2. í•™ìƒ ê´€ë¦¬ í•¨ìˆ˜ í™•ì¥

`functions/src/modules/personal/studentManagement.ts`ì— ì¶”ê°€:

```typescript
// í•™ìƒ + ì‹œê°„í‘œ ì •ë³´ í†µí•© ì¡°íšŒ
export const getStudentsWithTimetables = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;

  // ëª¨ë“  í•™ìƒ ì¡°íšŒ
  const studentsSnapshot = await db
    .collection(`users/${userId}/students`)
    .where("isActive", "==", true)
    .orderBy("name")
    .get();

  const studentsWithTimetables = [];

  for (const studentDoc of studentsSnapshot.docs) {
    const studentData = { id: studentDoc.id, ...studentDoc.data() };

    // í•´ë‹¹ í•™ìƒì˜ í™œì„± ì‹œê°„í‘œ ì¡°íšŒ
    const timetableSnapshot = await db
      .collection(`users/${userId}/student_timetables`)
      .where("studentId", "==", studentDoc.id)
      .where("isActive", "==", true)
      .limit(1)
      .get();

    // ì‹œê°„í‘œ ê°œìˆ˜ ì¡°íšŒ
    const timetableCountSnapshot = await db
      .collection(`users/${userId}/student_timetables`)
      .where("studentId", "==", studentDoc.id)
      .get();

    studentsWithTimetables.push({
      ...studentData,
      activeTimetable: timetableSnapshot.empty ? null :
        { id: timetableSnapshot.docs[0].id, ...timetableSnapshot.docs[0].data() },
      timetableCount: timetableCountSnapshot.size
    });
  }

  return studentsWithTimetables;
});

export const getStudentWithTimetable = onCall(async (request) => {
  if (!request.auth) {
    throw new HttpsError("unauthenticated", "Google ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.");
  }

  const userId = request.auth.uid;
  const { studentId } = request.data;

  // í•™ìƒ ì •ë³´ ì¡°íšŒ
  const studentDoc = await db.doc(`users/${userId}/students/${studentId}`).get();
  if (!studentDoc.exists) {
    throw new HttpsError("not-found", "í•™ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }

  const studentData = { id: studentDoc.id, ...studentDoc.data() };

  // í™œì„± ì‹œê°„í‘œ ì¡°íšŒ
  const timetableSnapshot = await db
    .collection(`users/${userId}/student_timetables`)
    .where("studentId", "==", studentId)
    .where("isActive", "==", true)
    .limit(1)
    .get();

  // ì‹œê°„í‘œ ê°œìˆ˜ ì¡°íšŒ
  const timetableCountSnapshot = await db
    .collection(`users/${userId}/student_timetables`)
    .where("studentId", "==", studentId)
    .get();

  return {
    ...studentData,
    activeTimetable: timetableSnapshot.empty ? null :
      { id: timetableSnapshot.docs[0].id, ...timetableSnapshot.docs[0].data() },
    timetableCount: timetableCountSnapshot.size
  };
});
```

### 3. functions/src/index.ts ì—…ë°ì´íŠ¸

```typescript
// ê¸°ì¡´ exports...

// í•™ìƒë³„ ì‹œê°„í‘œ ê´€ë¦¬ (ì‹ ê·œ)
export {
  createStudentTimetable,
  getStudentTimetables,
  updateStudentTimetable,
  deleteStudentTimetable,
  setActiveStudentTimetable,
  autoFillStudentTimetable,
  createStudentTimetableShareLink,
  contributeToStudentTimetable,
  processStudentTimetableContribution,
} from "./modules/personal/studentTimetableManagement";

// í™•ì¥ëœ í•™ìƒ ê´€ë¦¬
export {
  getStudentsWithTimetables,
  getStudentWithTimetable,
} from "./modules/personal/studentManagement";
```

## ğŸ¨ í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„

### 1. í†µí•© íƒ€ì… ì •ì˜

`frontend/src/types/student.ts` ì—…ë°ì´íŠ¸:

```typescript
// ê¸°ì¡´ Student ì¸í„°í˜ì´ìŠ¤ í™•ì¥
export interface StudentWithTimetable extends Student {
  activeTimetable?: StudentTimetableData;
  timetableCount: number;
}

// í•™ìƒë³„ ì‹œê°„í‘œ ë°ì´í„° (DATABASE_DESIGN.md ê¸°ì¤€)
export interface StudentTimetableData {
  id: string;
  studentId: string;
  studentName: string;
  name: string;
  description?: string;

  // 1ì°¨ ë ˆì´ì–´: ë“±ì›/í•˜ì› ê¸°ë³¸ í‹€
  basicSchedule: {
    arrivalTime: string;
    departureTime: string;
    daysOfWeek: DayOfWeek[];
    timeSlotInterval: number;
  };

  // 2ì°¨ ë ˆì´ì–´: êµ¬ì²´ì ì¸ ì¼ì •
  detailedSchedule: {
    [dayOfWeek: string]: {
      timeSlots: TimeSlot[];
    };
  };

  // ê³µìœ  ê¸°ëŠ¥
  isShared: boolean;
  shareToken?: string;
  shareSettings: {
    allowEdit: boolean;
    allowView: boolean;
    expiresAt?: Date;
  };

  // ìë™ ì±„ìš°ê¸° ì„¤ì •
  autoFillSettings: {
    enabled: boolean;
    defaultSubject: string;
    fillEmptySlots: boolean;
  };

  isActive: boolean;
  isDefault: boolean;
  createdAt: Date;
  updatedAt: Date;
  userId: string;
}

export interface TimeSlot {
  startTime: string;
  endTime: string;
  subject: string;
  type: 'class' | 'self_study';
  isAutoGenerated: boolean;
  color?: string;
  teacher?: string;
  location?: string;
  notes?: string;
}

export type DayOfWeek = 'monday' | 'tuesday' | 'wednesday' | 'thursday' | 'friday' | 'saturday' | 'sunday';

// ìš”ì²­ íƒ€ì…ë“¤
export interface CreateStudentTimetableRequest {
  studentId: string;
  name: string;
  basicSchedule: {
    arrivalTime: string;
    departureTime: string;
    daysOfWeek: DayOfWeek[];
    timeSlotInterval: number;
  };
  autoFillSettings?: {
    enabled: boolean;
    defaultSubject: string;
    fillEmptySlots: boolean;
  };
}

export interface UpdateStudentTimetableRequest {
  name?: string;
  description?: string;
  basicSchedule?: any;
  detailedSchedule?: any;
  shareSettings?: any;
  autoFillSettings?: any;
}

export interface ShareTimetableRequest {
  allowEdit: boolean;
  allowView: boolean;
  expiresAt?: Date;
}
```

### 2. ë°±ì—”ë“œ ì„œë¹„ìŠ¤ í†µí•©

`frontend/src/services/backendService.ts` í™•ì¥:

```typescript
// ê¸°ì¡´ imports...

// í•™ìƒë³„ ì‹œê°„í‘œ ê´€ë¦¬ ì„œë¹„ìŠ¤
export const studentTimetableService = {
  // í•™ìƒ + ì‹œê°„í‘œ í†µí•© ì¡°íšŒ
  getStudentsWithTimetables: async (): Promise<StudentWithTimetable[]> => {
    const getStudentsWithTimetablesFunc = httpsCallable(functions, 'getStudentsWithTimetables');
    const result = await getStudentsWithTimetablesFunc();
    return result.data as StudentWithTimetable[];
  },

  getStudentWithTimetable: async (studentId: string): Promise<StudentWithTimetable> => {
    const getStudentWithTimetableFunc = httpsCallable(functions, 'getStudentWithTimetable');
    const result = await getStudentWithTimetableFunc({ studentId });
    return result.data as StudentWithTimetable;
  },

  // ì‹œê°„í‘œ CRUD
  createStudentTimetable: async (request: CreateStudentTimetableRequest): Promise<StudentTimetableData> => {
    const createFunc = httpsCallable(functions, 'createStudentTimetable');
    const result = await createFunc(request);
    return result.data as StudentTimetableData;
  },

  getStudentTimetables: async (studentId: string): Promise<StudentTimetableData[]> => {
    const getFunc = httpsCallable(functions, 'getStudentTimetables');
    const result = await getFunc({ studentId });
    return result.data as StudentTimetableData[];
  },

  updateStudentTimetable: async (
    timetableId: string,
    updates: UpdateStudentTimetableRequest
  ): Promise<void> => {
    const updateFunc = httpsCallable(functions, 'updateStudentTimetable');
    await updateFunc({ timetableId, updates });
  },

  deleteStudentTimetable: async (timetableId: string): Promise<void> => {
    const deleteFunc = httpsCallable(functions, 'deleteStudentTimetable');
    await deleteFunc({ timetableId });
  },

  // ê³ ê¸‰ ê¸°ëŠ¥
  autoFillStudentTimetable: async (timetableId: string): Promise<StudentTimetableData> => {
    const autoFillFunc = httpsCallable(functions, 'autoFillStudentTimetable');
    const result = await autoFillFunc({ timetableId });
    return result.data as StudentTimetableData;
  },

  createShareLink: async (timetableId: string, settings: ShareTimetableRequest): Promise<{shareToken: string, shareUrl: string}> => {
    const shareFunc = httpsCallable(functions, 'createStudentTimetableShareLink');
    const result = await shareFunc({ timetableId, shareSettings: settings });
    return result.data;
  },
};
```

### 3. í†µí•© TimeTable.tsx ì»´í¬ë„ŒíŠ¸

```typescript
// frontend/src/pages/TimeTable/TimeTable.tsx

import React, { useState, useEffect } from 'react';
import './TimeTable.css';
import { StudentWithTimetable, StudentTimetableData } from '../../types/student';
import { studentTimetableService } from '../../services/backendService';
import StudentListPanel from './components/StudentListPanel';
import StudentTimetablePanel from './components/StudentTimetablePanel';
import LoadingSpinner from '../../components/common/LoadingSpinner';
import ErrorMessage from '../../components/common/ErrorMessage';

const TimeTable: React.FC = () => {
  // ìƒíƒœ ê´€ë¦¬
  const [students, setStudents] = useState<StudentWithTimetable[]>([]);
  const [selectedStudent, setSelectedStudent] = useState<StudentWithTimetable | null>(null);
  const [selectedTimetable, setSelectedTimetable] = useState<StudentTimetableData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // ì´ˆê¸° ë°ì´í„° ë¡œë”©
  useEffect(() => {
    loadStudentsWithTimetables();
  }, []);

  const loadStudentsWithTimetables = async () => {
    try {
      setLoading(true);
      setError(null);

      const studentsData = await studentTimetableService.getStudentsWithTimetables();
      setStudents(studentsData);

      // ì²« ë²ˆì§¸ í•™ìƒ ìë™ ì„ íƒ
      if (studentsData.length > 0) {
        handleStudentSelect(studentsData[0]);
      }
    } catch (err) {
      setError('í•™ìƒ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      console.error('Error loading students:', err);
    } finally {
      setLoading(false);
    }
  };

  // í•™ìƒ ì„ íƒ ì²˜ë¦¬
  const handleStudentSelect = async (student: StudentWithTimetable) => {
    try {
      setSelectedStudent(student);
      setSelectedTimetable(student.activeTimetable || null);

      // ìƒì„¸ ì‹œê°„í‘œ ì •ë³´ ë¡œë”© (í•„ìš”í•œ ê²½ìš°)
      if (student.activeTimetable) {
        // ì´ë¯¸ ê¸°ë³¸ ì •ë³´ê°€ ìˆìœ¼ë¯€ë¡œ ì¶”ê°€ ë¡œë”©ì€ ì„ íƒì 
      }
    } catch (err) {
      setError('í•™ìƒ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      console.error('Error selecting student:', err);
    }
  };

  // ìƒˆ í•™ìƒ ì¶”ê°€
  const handleStudentCreate = () => {
    // í•™ìƒ ì¶”ê°€ ëª¨ë‹¬ ë˜ëŠ” í˜ì´ì§€ë¡œ ì´ë™
    console.log('ìƒˆ í•™ìƒ ì¶”ê°€');
  };

  // ì‹œê°„í‘œ ì—…ë°ì´íŠ¸
  const handleTimetableUpdate = async (updatedTimetable: StudentTimetableData) => {
    try {
      setSelectedTimetable(updatedTimetable);

      // í•™ìƒ ëª©ë¡ë„ ì—…ë°ì´íŠ¸
      setStudents(prevStudents =>
        prevStudents.map(student =>
          student.id === selectedStudent?.id
            ? { ...student, activeTimetable: updatedTimetable }
            : student
        )
      );
    } catch (err) {
      setError('ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      console.error('Error updating timetable:', err);
    }
  };

  // ìƒˆ ì‹œê°„í‘œ ìƒì„±
  const handleTimetableCreate = async () => {
    if (!selectedStudent) return;

    try {
      // ì‹œê°„í‘œ ìƒì„± ë¡œì§
      console.log('ìƒˆ ì‹œê°„í‘œ ìƒì„±');
    } catch (err) {
      setError('ì‹œê°„í‘œ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      console.error('Error creating timetable:', err);
    }
  };

  if (loading) {
    return <LoadingSpinner />;
  }

  return (
    <div className="timetable-page">
      {error && <ErrorMessage message={error} onClose={() => setError(null)} />}

      {/* ì™¼ìª½: í•™ìƒ ëª©ë¡ íŒ¨ë„ */}
      <div className="student-list-section">
        <StudentListPanel
          students={students}
          selectedStudent={selectedStudent}
          onStudentSelect={handleStudentSelect}
          onStudentCreate={handleStudentCreate}
          onRefresh={loadStudentsWithTimetables}
        />
      </div>

      {/* ì˜¤ë¥¸ìª½: ì‹œê°„í‘œ íŒ¨ë„ */}
      <div className="timetable-section">
        {selectedStudent ? (
          <StudentTimetablePanel
            student={selectedStudent}
            timetable={selectedTimetable}
            onTimetableUpdate={handleTimetableUpdate}
            onTimetableCreate={handleTimetableCreate}
          />
        ) : (
          <div className="empty-timetable-state">
            <h3>í•™ìƒì„ ì„ íƒí•´ì£¼ì„¸ìš”</h3>
            <p>ì™¼ìª½ì—ì„œ í•™ìƒì„ ì„ íƒí•˜ë©´ í•´ë‹¹ í•™ìƒì˜ ì‹œê°„í‘œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
        )}
      </div>
    </div>
  );
};

export default TimeTable;
```

### 4. í•˜ìœ„ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„

#### A. StudentListPanel ì»´í¬ë„ŒíŠ¸

```typescript
// frontend/src/pages/TimeTable/components/StudentListPanel.tsx

import React, { useState } from 'react';
import { StudentWithTimetable } from '../../../types/student';
import './StudentListPanel.css';

interface StudentListPanelProps {
  students: StudentWithTimetable[];
  selectedStudent: StudentWithTimetable | null;
  onStudentSelect: (student: StudentWithTimetable) => void;
  onStudentCreate: () => void;
  onRefresh: () => void;
}

const StudentListPanel: React.FC<StudentListPanelProps> = ({
  students,
  selectedStudent,
  onStudentSelect,
  onStudentCreate,
  onRefresh
}) => {
  const [searchTerm, setSearchTerm] = useState('');

  // í•™ìƒ ê²€ìƒ‰ í•„í„°ë§
  const filteredStudents = students.filter(student =>
    student.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    student.grade.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="student-list-panel">
      {/* í—¤ë” */}
      <div className="panel-header">
        <h2>í•™ìƒ ëª©ë¡</h2>
        <div className="header-actions">
          <button
            className="btn-refresh"
            onClick={onRefresh}
            title="ìƒˆë¡œê³ ì¹¨"
          >
            ğŸ”„
          </button>
          <button
            className="btn-add-student"
            onClick={onStudentCreate}
          >
            + í•™ìƒ ì¶”ê°€
          </button>
        </div>
      </div>

      {/* ê²€ìƒ‰ */}
      <div className="search-section">
        <input
          type="text"
          placeholder="í•™ìƒ ì´ë¦„ ë˜ëŠ” í•™ë…„ìœ¼ë¡œ ê²€ìƒ‰..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="search-input"
        />
      </div>

      {/* í•™ìƒ ëª©ë¡ */}
      <div className="student-list">
        {filteredStudents.length === 0 ? (
          <div className="empty-state">
            <p>ë“±ë¡ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <button onClick={onStudentCreate} className="btn-add-first">
              ì²« ë²ˆì§¸ í•™ìƒ ì¶”ê°€í•˜ê¸°
            </button>
          </div>
        ) : (
          filteredStudents.map(student => (
            <div
              key={student.id}
              className={`student-item ${selectedStudent?.id === student.id ? 'selected' : ''}`}
              onClick={() => onStudentSelect(student)}
            >
              <div className="student-info">
                <h3 className="student-name">{student.name}</h3>
                <p className="student-grade">{student.grade}</p>
                {student.activeTimetable ? (
                  <p className="student-timetable">
                    ğŸ“… {student.activeTimetable.name}
                  </p>
                ) : (
                  <p className="no-timetable">ì‹œê°„í‘œ ì—†ìŒ</p>
                )}
              </div>
              <div className="student-meta">
                <span className="timetable-count">
                  {student.timetableCount}ê°œ ì‹œê°„í‘œ
                </span>
              </div>
            </div>
          ))
        )}
      </div>
    </div>
  );
};

export default StudentListPanel;
```

#### B. StudentTimetablePanel ì»´í¬ë„ŒíŠ¸

```typescript
// frontend/src/pages/TimeTable/components/StudentTimetablePanel.tsx

import React, { useState } from 'react';
import { StudentWithTimetable, StudentTimetableData } from '../../../types/student';
import TimetableHeader from './TimetableHeader';
import BasicSchedulePanel from './BasicSchedulePanel';
import TimetableGrid from './TimetableGrid';
import SharePanel from './SharePanel';
import './StudentTimetablePanel.css';

interface StudentTimetablePanelProps {
  student: StudentWithTimetable;
  timetable: StudentTimetableData | null;
  onTimetableUpdate: (timetable: StudentTimetableData) => void;
  onTimetableCreate: () => void;
}

const StudentTimetablePanel: React.FC<StudentTimetablePanelProps> = ({
  student,
  timetable,
  onTimetableUpdate,
  onTimetableCreate
}) => {
  const [showSharePanel, setShowSharePanel] = useState(false);
  const [showBasicSettings, setShowBasicSettings] = useState(false);

  if (!timetable) {
    return (
      <div className="no-timetable-state">
        <div className="student-info">
          <h2>{student.name}ì˜ ì‹œê°„í‘œ</h2>
          <p className="student-details">{student.grade} | {student.email}</p>
        </div>
        <div className="empty-content">
          <h3>ì‹œê°„í‘œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
          <p>ì´ í•™ìƒì„ ìœ„í•œ ì²« ë²ˆì§¸ ì‹œê°„í‘œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
          <button onClick={onTimetableCreate} className="btn-create-timetable">
            ì‹œê°„í‘œ ë§Œë“¤ê¸°
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="student-timetable-panel">
      {/* í—¤ë” */}
      <TimetableHeader
        student={student}
        timetable={timetable}
        onShowShare={() => setShowSharePanel(true)}
        onShowBasicSettings={() => setShowBasicSettings(true)}
        onTimetableUpdate={onTimetableUpdate}
      />

      {/* 1ì°¨ ë ˆì´ì–´: ê¸°ë³¸ ìŠ¤ì¼€ì¤„ ì„¤ì • (í† ê¸€ ê°€ëŠ¥) */}
      {showBasicSettings && (
        <BasicSchedulePanel
          basicSchedule={timetable.basicSchedule}
          autoFillSettings={timetable.autoFillSettings}
          onUpdate={(updates) => {
            // ê¸°ë³¸ ìŠ¤ì¼€ì¤„ ì—…ë°ì´íŠ¸
            onTimetableUpdate({
              ...timetable,
              ...updates
            });
          }}
          onClose={() => setShowBasicSettings(false)}
        />
      )}

      {/* 2ì°¨ ë ˆì´ì–´: ìƒì„¸ ì‹œê°„í‘œ ê·¸ë¦¬ë“œ */}
      <TimetableGrid
        timetable={timetable}
        onTimetableUpdate={onTimetableUpdate}
      />

      {/* ê³µìœ  íŒ¨ë„ (ëª¨ë‹¬) */}
      {showSharePanel && (
        <SharePanel
          timetable={timetable}
          onClose={() => setShowSharePanel(false)}
          onUpdate={onTimetableUpdate}
        />
      )}
    </div>
  );
};

export default StudentTimetablePanel;
```

#### C. TimetableGrid ì»´í¬ë„ŒíŠ¸ (ê³ ê¸‰ 2ë ˆì´ì–´ êµ¬ì¡°)

```typescript
// frontend/src/pages/TimeTable/components/TimetableGrid.tsx

import React, { useState } from 'react';
import { StudentTimetableData, TimeSlot, DayOfWeek } from '../../../types/student';
import { studentTimetableService } from '../../../services/backendService';
import TimeSlotEditModal from './TimeSlotEditModal';
import './TimetableGrid.css';

interface TimetableGridProps {
  timetable: StudentTimetableData;
  onTimetableUpdate: (timetable: StudentTimetableData) => void;
}

const TimetableGrid: React.FC<TimetableGridProps> = ({
  timetable,
  onTimetableUpdate
}) => {
  const [editingSlot, setEditingSlot] = useState<{
    day: string;
    slot: TimeSlot;
    index: number;
  } | null>(null);
  const [isAutoFilling, setIsAutoFilling] = useState(false);

  const daysOfWeek: DayOfWeek[] = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
  const dayNames = {
    monday: 'ì›”',
    tuesday: 'í™”',
    wednesday: 'ìˆ˜',
    thursday: 'ëª©',
    friday: 'ê¸ˆ',
    saturday: 'í† ',
    sunday: 'ì¼'
  };

  // ì‹œê°„ ìŠ¬ë¡¯ ìƒì„± (ë“±ì› ì‹œê°„ë¶€í„° í•˜ì› ì‹œê°„ê¹Œì§€)
  const generateTimeSlots = () => {
    const { arrivalTime, departureTime, timeSlotInterval } = timetable.basicSchedule;
    const slots = [];

    const startMinutes = timeToMinutes(arrivalTime);
    const endMinutes = timeToMinutes(departureTime);

    for (let minutes = startMinutes; minutes < endMinutes; minutes += timeSlotInterval) {
      slots.push({
        startTime: minutesToTime(minutes),
        endTime: minutesToTime(minutes + timeSlotInterval)
      });
    }

    return slots;
  };

  // ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸°
  const handleAutoFill = async () => {
    try {
      setIsAutoFilling(true);
      const updatedTimetable = await studentTimetableService.autoFillStudentTimetable(timetable.id);
      onTimetableUpdate(updatedTimetable);
    } catch (error) {
      console.error('ìë™ ì±„ìš°ê¸° ì‹¤íŒ¨:', error);
    } finally {
      setIsAutoFilling(false);
    }
  };

  // ì‹œê°„ ìŠ¬ë¡¯ í´ë¦­ ì²˜ë¦¬
  const handleSlotClick = (day: string, timeSlot: { startTime: string; endTime: string }) => {
    // í•´ë‹¹ ì‹œê°„ëŒ€ì— ê¸°ì¡´ ì¼ì •ì´ ìˆëŠ”ì§€ í™•ì¸
    const daySchedule = timetable.detailedSchedule[day];
    const existingSlotIndex = daySchedule?.timeSlots.findIndex(slot =>
      slot.startTime === timeSlot.startTime && slot.endTime === timeSlot.endTime
    );

    if (existingSlotIndex !== undefined && existingSlotIndex >= 0) {
      // ê¸°ì¡´ ì¼ì • í¸ì§‘
      setEditingSlot({
        day,
        slot: daySchedule.timeSlots[existingSlotIndex],
        index: existingSlotIndex
      });
    } else {
      // ìƒˆ ì¼ì • ì¶”ê°€
      setEditingSlot({
        day,
        slot: {
          startTime: timeSlot.startTime,
          endTime: timeSlot.endTime,
          subject: '',
          type: 'class',
          isAutoGenerated: false,
          color: '#4CAF50'
        },
        index: -1 // ìƒˆ í•­ëª©
      });
    }
  };

  // ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ë Œë”ë§
  const timeSlots = generateTimeSlots();
  const activeDays = timetable.basicSchedule.daysOfWeek;

  return (
    <div className="timetable-grid-container">
      {/* ë„êµ¬ ëª¨ìŒ */}
      <div className="timetable-toolbar">
        <div className="toolbar-left">
          <h3>{timetable.name}</h3>
          <span className="time-range">
            {timetable.basicSchedule.arrivalTime} - {timetable.basicSchedule.departureTime}
          </span>
        </div>
        <div className="toolbar-right">
          <button
            onClick={handleAutoFill}
            disabled={isAutoFilling}
            className="btn-auto-fill"
          >
            {isAutoFilling ? 'ì±„ìš°ëŠ” ì¤‘...' : 'ğŸ”„ ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸°'}
          </button>
        </div>
      </div>

      {/* ì‹œê°„í‘œ ê·¸ë¦¬ë“œ */}
      <div className="timetable-grid">
        {/* í—¤ë”: ìš”ì¼ */}
        <div className="grid-header">
          <div className="time-column-header">ì‹œê°„</div>
          {activeDays.map(day => (
            <div key={day} className="day-header">
              {dayNames[day]}
            </div>
          ))}
        </div>

        {/* ì‹œê°„ ìŠ¬ë¡¯ë“¤ */}
        <div className="grid-body">
          {timeSlots.map((timeSlot, timeIndex) => (
            <div key={timeIndex} className="time-row">
              {/* ì‹œê°„ ì»¬ëŸ¼ */}
              <div className="time-cell">
                <span className="time-label">
                  {timeSlot.startTime}
                </span>
              </div>

              {/* ê° ìš”ì¼ë³„ ì…€ */}
              {activeDays.map(day => {
                const daySchedule = timetable.detailedSchedule[day];
                const existingSlot = daySchedule?.timeSlots.find(slot =>
                  slot.startTime === timeSlot.startTime && slot.endTime === timeSlot.endTime
                );

                return (
                  <div
                    key={`${day}-${timeIndex}`}
                    className={`schedule-cell ${existingSlot ? 'has-content' : 'empty'}`}
                    onClick={() => handleSlotClick(day, timeSlot)}
                  >
                    {existingSlot ? (
                      <div
                        className={`slot-content ${existingSlot.type}`}
                        style={{ backgroundColor: existingSlot.color }}
                      >
                        <div className="slot-subject">{existingSlot.subject}</div>
                        {existingSlot.teacher && (
                          <div className="slot-teacher">{existingSlot.teacher}</div>
                        )}
                        {existingSlot.isAutoGenerated && (
                          <div className="auto-generated-badge">ìë™</div>
                        )}
                      </div>
                    ) : (
                      <div className="empty-slot">
                        <span>+</span>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          ))}
        </div>
      </div>

      {/* ì‹œê°„ ìŠ¬ë¡¯ í¸ì§‘ ëª¨ë‹¬ */}
      {editingSlot && (
        <TimeSlotEditModal
          day={editingSlot.day}
          timeSlot={editingSlot.slot}
          isNew={editingSlot.index === -1}
          onSave={async (updatedSlot) => {
            // ì‹œê°„í‘œ ì—…ë°ì´íŠ¸ ë¡œì§
            const updatedSchedule = { ...timetable.detailedSchedule };

            if (!updatedSchedule[editingSlot.day]) {
              updatedSchedule[editingSlot.day] = { timeSlots: [] };
            }

            if (editingSlot.index === -1) {
              // ìƒˆ í•­ëª© ì¶”ê°€
              updatedSchedule[editingSlot.day].timeSlots.push(updatedSlot);
            } else {
              // ê¸°ì¡´ í•­ëª© ìˆ˜ì •
              updatedSchedule[editingSlot.day].timeSlots[editingSlot.index] = updatedSlot;
            }

            const updatedTimetable = {
              ...timetable,
              detailedSchedule: updatedSchedule
            };

            await studentTimetableService.updateStudentTimetable(timetable.id, {
              detailedSchedule: updatedSchedule
            });

            onTimetableUpdate(updatedTimetable);
            setEditingSlot(null);
          }}
          onDelete={async () => {
            if (editingSlot.index >= 0) {
              const updatedSchedule = { ...timetable.detailedSchedule };
              updatedSchedule[editingSlot.day].timeSlots.splice(editingSlot.index, 1);

              const updatedTimetable = {
                ...timetable,
                detailedSchedule: updatedSchedule
              };

              await studentTimetableService.updateStudentTimetable(timetable.id, {
                detailedSchedule: updatedSchedule
              });

              onTimetableUpdate(updatedTimetable);
            }
            setEditingSlot(null);
          }}
          onClose={() => setEditingSlot(null)}
        />
      )}
    </div>
  );
};

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
function timeToMinutes(time: string): number {
  const [hours, minutes] = time.split(':').map(Number);
  return hours * 60 + minutes;
}

function minutesToTime(minutes: number): string {
  const hours = Math.floor(minutes / 60);
  const mins = minutes % 60;
  return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
}

export default TimetableGrid;
```

### 5. CSS ìŠ¤íƒ€ì¼ë§

`frontend/src/pages/TimeTable/TimeTable.css`:

```css
/* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
.timetable-page {
  display: flex;
  height: 100vh;
  background-color: #f5f5f5;
  gap: 16px;
  padding: 16px;
}

/* ì™¼ìª½ í•™ìƒ ëª©ë¡ ì„¹ì…˜ */
.student-list-section {
  width: 320px;
  min-width: 320px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

/* ì˜¤ë¥¸ìª½ ì‹œê°„í‘œ ì„¹ì…˜ */
.timetable-section {
  flex: 1;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  overflow: auto;
}

/* ë¹ˆ ìƒíƒœ */
.empty-timetable-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  padding: 40px;
  text-align: center;
  color: #666;
}

.empty-timetable-state h3 {
  margin-bottom: 16px;
  color: #333;
}

.empty-timetable-state p {
  margin-bottom: 24px;
  font-size: 14px;
}

/* í•™ìƒ ëª©ë¡ íŒ¨ë„ ìŠ¤íƒ€ì¼ */
.student-list-panel {
  height: 100%;
  display: flex;
  flex-direction: column;
}

.panel-header {
  display: flex;
  justify-content: between;
  align-items: center;
  padding: 16px;
  border-bottom: 1px solid #e0e0e0;
}

.panel-header h2 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.header-actions {
  display: flex;
  gap: 8px;
}

.btn-refresh {
  background: none;
  border: none;
  cursor: pointer;
  padding: 4px;
  border-radius: 4px;
}

.btn-refresh:hover {
  background-color: #f0f0f0;
}

.btn-add-student {
  background-color: #2196F3;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  font-size: 12px;
  cursor: pointer;
}

.btn-add-student:hover {
  background-color: #1976D2;
}

/* ê²€ìƒ‰ ì„¹ì…˜ */
.search-section {
  padding: 16px;
  border-bottom: 1px solid #e0e0e0;
}

.search-input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.search-input:focus {
  outline: none;
  border-color: #2196F3;
}

/* í•™ìƒ ëª©ë¡ */
.student-list {
  flex: 1;
  overflow-y: auto;
  padding: 8px;
}

.student-item {
  padding: 12px;
  margin-bottom: 8px;
  border-radius: 6px;
  border: 1px solid #e0e0e0;
  cursor: pointer;
  transition: all 0.2s ease;
}

.student-item:hover {
  border-color: #2196F3;
  box-shadow: 0 2px 4px rgba(33, 150, 243, 0.1);
}

.student-item.selected {
  border-color: #2196F3;
  background-color: #E3F2FD;
}

.student-info h3 {
  margin: 0 0 4px 0;
  font-size: 16px;
  font-weight: 600;
}

.student-grade {
  margin: 0 0 8px 0;
  font-size: 14px;
  color: #666;
}

.student-timetable {
  margin: 0;
  font-size: 12px;
  color: #4CAF50;
}

.no-timetable {
  margin: 0;
  font-size: 12px;
  color: #999;
}

.student-meta {
  margin-top: 8px;
  text-align: right;
}

.timetable-count {
  font-size: 11px;
  color: #999;
}

/* ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
.timetable-grid-container {
  padding: 16px;
}

.timetable-toolbar {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: 16px;
  padding: 12px;
  background-color: #f8f9fa;
  border-radius: 6px;
}

.toolbar-left h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.time-range {
  font-size: 14px;
  color: #666;
  margin-left: 8px;
}

.btn-auto-fill {
  background-color: #FF9800;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.btn-auto-fill:hover:not(:disabled) {
  background-color: #F57C00;
}

.btn-auto-fill:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
.timetable-grid {
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  overflow: hidden;
}

.grid-header {
  display: grid;
  grid-template-columns: 80px repeat(auto-fit, minmax(120px, 1fr));
  background-color: #f5f5f5;
  border-bottom: 2px solid #e0e0e0;
}

.time-column-header,
.day-header {
  padding: 12px 8px;
  font-weight: 600;
  text-align: center;
  border-right: 1px solid #e0e0e0;
}

.time-row {
  display: grid;
  grid-template-columns: 80px repeat(auto-fit, minmax(120px, 1fr));
  border-bottom: 1px solid #e0e0e0;
  min-height: 60px;
}

.time-cell {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px;
  border-right: 1px solid #e0e0e0;
  background-color: #fafafa;
}

.time-label {
  font-size: 12px;
  font-weight: 500;
  color: #666;
}

.schedule-cell {
  border-right: 1px solid #e0e0e0;
  cursor: pointer;
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 60px;
}

.schedule-cell:hover {
  background-color: #f0f8ff;
}

.schedule-cell.has-content:hover {
  background-color: transparent;
}

.slot-content {
  width: 100%;
  height: 100%;
  padding: 8px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  border-radius: 4px;
  margin: 2px;
  position: relative;
  color: white;
  font-weight: 500;
}

.slot-content.class {
  background-color: #4CAF50;
}

.slot-content.self_study {
  background-color: #9E9E9E;
}

.slot-subject {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 2px;
}

.slot-teacher {
  font-size: 11px;
  opacity: 0.9;
}

.auto-generated-badge {
  position: absolute;
  top: 2px;
  right: 2px;
  background-color: rgba(255, 255, 255, 0.8);
  color: #666;
  font-size: 8px;
  padding: 1px 3px;
  border-radius: 2px;
}

.empty-slot {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #ccc;
  font-size: 20px;
  font-weight: 300;
}

.empty-slot:hover {
  color: #2196F3;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
  .timetable-page {
    flex-direction: column;
    height: auto;
    min-height: 100vh;
  }

  .student-list-section {
    width: 100%;
    height: 200px;
  }

  .timetable-section {
    min-height: 500px;
  }

  .grid-header,
  .time-row {
    grid-template-columns: 60px repeat(auto-fit, minmax(80px, 1fr));
  }

  .slot-content {
    padding: 4px;
  }

  .slot-subject {
    font-size: 11px;
  }

  .slot-teacher {
    font-size: 9px;
  }
}
```

## ğŸ”„ ë°ì´í„° í”Œë¡œìš°

### 1. ì´ˆê¸° ë¡œë”© ìˆœì„œ
```
1. TimeTable.tsx ë§ˆìš´íŠ¸ â†’ useEffect ì‹¤í–‰
2. getStudentsWithTimetables() í˜¸ì¶œ
3. ê° í•™ìƒë³„ í™œì„± ì‹œê°„í‘œ ì •ë³´ í•¨ê»˜ ë¡œë“œ
4. ì²« ë²ˆì§¸ í•™ìƒ ìë™ ì„ íƒ
5. ì„ íƒëœ í•™ìƒì˜ ì‹œê°„í‘œ í‘œì‹œ
```

### 2. í•™ìƒ ì„ íƒ í”Œë¡œìš°
```
1. StudentListPanelì—ì„œ í•™ìƒ í´ë¦­
2. handleStudentSelect() í˜¸ì¶œ
3. ì„ íƒëœ í•™ìƒì˜ í™œì„± ì‹œê°„í‘œ ì„¤ì •
4. StudentTimetablePanel ë¦¬ë Œë”ë§
5. TimetableGridì— ì‹œê°„í‘œ ë°ì´í„° í‘œì‹œ
```

### 3. ì‹œê°„í‘œ í¸ì§‘ í”Œë¡œìš°
```
1. TimetableGridì—ì„œ ì‹œê°„ ìŠ¬ë¡¯ í´ë¦­
2. TimeSlotEditModal ì—´ê¸°
3. ì‚¬ìš©ìê°€ í¸ì§‘ í›„ ì €ì¥
4. updateStudentTimetable() í˜¸ì¶œ
5. ë¡œì»¬ ìƒíƒœ ì—…ë°ì´íŠ¸
6. UI ë¦¬ë Œë”ë§
```

### 4. ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸° í”Œë¡œìš°
```
1. "ìë™ ììŠµì‹œê°„ ì±„ìš°ê¸°" ë²„íŠ¼ í´ë¦­
2. autoFillStudentTimetable() í˜¸ì¶œ
3. ë°±ì—”ë“œì—ì„œ ë¹ˆ ì‹œê°„ëŒ€ ê³„ì‚°
4. ììŠµ ì‹œê°„ ìë™ ìƒì„± (isAutoGenerated: true)
5. ì—…ë°ì´íŠ¸ëœ ì‹œê°„í‘œ ë°˜í™˜
6. UI ì—…ë°ì´íŠ¸
```

### 5. ì‹œê°„í‘œ ê³µìœ  í”Œë¡œìš°
```
1. "ê³µìœ " ë²„íŠ¼ í´ë¦­ â†’ SharePanel ì—´ê¸°
2. ê³µìœ  ì„¤ì • ì…ë ¥ í›„ ìƒì„±
3. createStudentTimetableShareLink() í˜¸ì¶œ
4. ê³ ìœ  shareToken ìƒì„±
5. shared_schedules ì»¬ë ‰ì…˜ì— ê³µìœ  ì •ë³´ ì €ì¥
6. ê³µìœ  ë§í¬ URL ë°˜í™˜
```

## ğŸš€ êµ¬í˜„ ìš°ì„ ìˆœìœ„

<function_calls>
<invoke name="TodoWrite">
<parameter name="todos">[{"content": "í†µí•©ëœ ì‹œê°„í‘œ í˜ì´ì§€ êµ¬í˜„ ê³„íšì„œ ì‘ì„±", "status": "completed", "activeForm": "í†µí•©ëœ ì‹œê°„í‘œ í˜ì´ì§€ êµ¬í˜„ ê³„íšì„œ ì‘ì„± ì™„ë£Œ"}, {"content": "Phase 1 êµ¬í˜„ ê³„íš ì •ë¦¬", "status": "in_progress", "activeForm": "Phase 1 êµ¬í˜„ ê³„íš ì •ë¦¬ ì¤‘"}]